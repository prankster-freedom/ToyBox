# エージェントが遵守すべきルール (GEMINI.md)

このドキュメントは、エージェントであるあなたが、このプロジェクトで開発作業を行う際に遵守すべきルールとワークフローを定義します。

## 1. 最重要原則 (Core Principles)

以下の原則は、すべての作業の基礎となる最優先事項です。

### 1.1. 厳格な承認ベースの進行
すべての作業において、一つのステップ（工程）が完了したら、その結果を報告し、次のアクションについて**必ずユーザーの明確な承認を得てください。** ユーザーからの指示がない限り、複数の操作をまとめて実行したり、次のステップを推測して進めたりしてはいけません。

### 1.2. ツールと環境の制約の遵守
あなたが使用するツールには、特にシェルコマンド実行において、以下のような制約があります。これらの制約を十分に理解し、エラーを回避する最も安全な方法を選択してください。

- **シェル:** コマンドは `cmd.exe` で実行されます。`git bash` など他のシェルに変更することはできません。
- **対話的コマンドの禁止:** `git commit`実行時のテキストエディタ起動など、対話的な操作を要求するコマンドは失敗します。
- **特殊文字の制限:** コマンドの引数に特定の特殊文字（特に `()` や ` `` ` ）が含まれていると、ツールのセキュリティ機能により失敗する可能性があります。

---

## 2. 開発・修正ワークフロー (Development/Fix Workflow)

すべての開発・修正作業は、以下のステップ（工程）に沿って、原則1（承認ベース）を遵守しながら進めてください。

**【重要】** 各工程でのやり取りの中で仕様や設計の修正が発生した場合、それが前工程の成果物（`SPEC.md`や`DESIGN.md`）に起因するものでないか常に振り返り、必要に応じて前工程の成果物を修正することも提案してください。

### Step 1: 要求分析と計画
- システムへの要求仕様は`SPEC.md`という名前でドキュメント化します。既に存在する場合はそれをベースにします。
- 要求仕様を分析し、必要に応じて不明点の問い合わせや改善提案を行います。
- 機能要求（FR）、非機能要求（NFR）はID管理します。
- ユースケース図やシーケンス図（PlantUML形式）を用いて仕様を具体化し、`SPEC.md`に記載します。**注意: シーケンス図には、システムとアクター間の関わりのみを記載してください。システム内部の機能間のやり取りは設計情報のため、記載してはいけません。**
- 最終的な要求仕様を合意できたら、合意に至った経緯や根拠もドキュメントに残してください。
- 最終版のドキュメントについてユーザーから**明示的に承認を得たら**、次の「設計」工程に進みます。

### Step 2: 設計
- 設計仕様は`DESIGN.md`という名前でドキュメント化します。
- [arc42](https://arc42.org/) などの確立されたテンプレートを参考に、構造化して記述します。
- アーキテクチャや利用技術の案について、まずユーザーの合意を得てから詳細設計に進みます。
- 最終的な設計仕様を合意できたら、合意に至った経緯や根拠もドキュメントに残してください。
- 最終版のドキュメントについてユーザーから**明示的に承認を得たら**、次の「実装」工程に進みます。

### Step 3: 実装
- 新規機能は、まずスケルトン（関数、API、イベントハンドラ等）から実装し、次に詳細ロジックを実装します。呼び出し前後のエラー判定や例外処理も実装します。
- **【重要】** 実装作業中は、「原則1: 厳格な承認ベースの進行」を特に厳しく遵守してください。**一つのファイル修正やコマンド実行ごとに**、結果を報告し承認を待ちます。
- サーバーの起動やAPIの実行といった動的テスト（動作確認）は、ユーザーの**承認なしに行ってはいけません。**

### Step 4: コミットとプッシュ
- ユーザーからコミットの指示があった場合にのみ、このステップに進みます。
- 1. `git status`, `git diff` で変更内容を確認し、ユーザーに報告・**承認を求めます。**
- 2. コミットメッセージ案を提案し、ユーザーの**承認を得ます。**
- 3. `git commit` を実行します。この際、「原則1.2」で述べた`git`操作の制約（特にメッセージの特殊文字）に最大限注意を払い、最も安全な方法（例: 括弧を含まないメッセージにする）を選択します。
- 4. `git push` は、ユーザーから**明確な指示があった場合にのみ**実行します。

### Step 5: 付帯成果物作成
仕様書、設計書、実装コード以外に下記も作成します。
  - [ローカル開発環境の設定及び操作マニュアル](./90_運用資料_ローカル開発環境の設定及び操作マニュアル.md)
  - [Google Cloud サービスの環境初期設定マニュアル](./90_Google_Cloud_環境初期設定マニュアル.md)
  - [デプロイ手順](./90_運用資料_DEPLOYMENT.md)
  - [エンドユーザー向け説明書](./90_運用資料_USER_MANUAL.md)

---

## 3. 特別な状況への対応 (Handling Special Situations)

### 3.1. 不具合対応
- SDKやAPI関連の不具合は、場当たり的な対応ではなく、公式ドキュメントや仕様を厳密に確認し、エラーメッセージの根本原因を特定してから修正案を提案します。
- ツールや環境が原因で操作が失敗した場合（例: `git commit`の文字化け問題）、その原因を正直に報告し、環境の制約内で実現可能な代替案をユーザーと協議します。

---

## 4. プロジェクト固有の要件 (Project-Specific Requirements)

### プロジェクト名: ToyBox
（以下、既存の記述をすべて維持します）
- このプロジェクトは、のモダンで標準的な技術をしようした様々な Web アプリケーションを構築する際のベースとして利用するためのサンプルアプリケーションの構築プロジェクトです。

### プロジェクトの目標 (Goals)

#### プロジェクトで取り上げる技術のテーマは大きく下記の技術である。

- クラウドサービス
- フロントエンド、バックエンド
- 生成 AI
- マイクロサービス
- コンテナ技術
- gRPC, REST API, Web API, HTTP/2, HTTP/3
- HTML Living Standard
- OAuth
- SPA
- Web コンポーネント, ES Modules
- Vue.js, Node.js
- CI, CD

### プロジェクトの方針

- 個人開発者が費用面で開発を継続できるように、オープンなエコシステムをうまく活用する。
- Cloud サービスには Google Cloud を利用することを前提として設計を最適化してよいが、今後他のサービスを利用する場合にも困らないように依存関係は局所化するように設計すること

#### 以下に述べる技術は利用禁止とする。

- React
- firebase