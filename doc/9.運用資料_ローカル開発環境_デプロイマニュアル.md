# ローカル開発環境 デプロイマニュアル（アプリケーション実行手順）

このドキュメントでは、ローカル環境における ToyBox アプリケーションの起動、テスト実行、およびデバッグ方法について説明します。

## 1. アプリケーションの実行

### 1.1. 開発モードでの起動

開発モードでは、`NODE_ENV` が `development` に設定されます。
また、`npm run dev` では `IS_LOCAL=true` が設定され、これにより認証がバイパスされ、Secure Cookie が無効化されます。
ファイル変更時の自動再起動 (nodemon) も有効になります。

**注意:** `npm run dev` は Datastore エミュレータへの接続を前提としています（`npm run start:emulator` を実行します）。事前にエミュレータを起動してください（後述）。

```bash
npm run dev
```

サーバーが起動すると、`http://localhost:3000` でアクセスできます。

### 1.2. テストの実行

(テストスクリプトが実装されている場合)

```bash
npm test
```

## 2. Datastore エミュレータの使用

ローカル開発では、Cloud Datastore の動作を模倣するためにエミュレータを使用します。

1.  別のターミナルを開き、エミュレータを起動します。

    ````bash
    ```bash
    npm run emulator
    ````

    ※ `gcloud beta emulators datastore start --host-port=localhost:8081` のエイリアスです。

2.  アプリケーションを起動します。
    ```bash
    npm run dev
    ```
    ※ `npm run dev` には `DATASTORE_EMULATOR_HOST=localhost:8081` の設定が含まれているため、手動での環境変数設定は不要です。

## 3. デバッグ

VS Code を使用している場合、`.vscode/launch.json` (もしあれば) を利用してデバッガをアタッチできます。
または、`console.log` を使用してデバッグ出力を確認してください。

API レスポンスへのデバッグログ出力 (`_debug` フィールド) は、環境変数 `ENABLE_DEBUG_LOGS` で制御されます。
デフォルトでは `true` (有効) です。無効にする場合は、環境変数 `ENABLE_DEBUG_LOGS=false` を設定して起動してください。
