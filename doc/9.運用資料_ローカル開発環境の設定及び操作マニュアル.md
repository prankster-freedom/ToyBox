# ローカル開発環境の設定及び操作マニュアル

このドキュメントでは、ToyBox プロジェクトをローカル環境でセットアップし、開発を行うための手順を説明します。

## 1. 前提条件

以下のソフトウェアがインストールされていることを確認してください。

- **Node.js**: v18 以降
- **npm**: Node.js に同梱されています
- **Git**: リポジトリのクローンに必要です
- **Google Cloud CLI (gcloud)**: Datastore エミュレータの使用に必要です (オプションですが推奨)

## 2. セットアップ手順

### 2.1. リポジトリのクローン

```bash
git clone <repository_url>
cd ToyBox
```

### 2.2. 依存パッケージのインストール

プロジェクトのルートディレクトリで以下のコマンドを実行します。

```bash
npm install
```

## 3. アプリケーションの実行

### 3.1. 開発モードでの起動

開発モードでは、`NODE_ENV` が `development` に設定されます。
また、`npm run dev` では `IS_LOCAL=true` が設定され、これにより認証がバイパスされ、Secure Cookie が無効化されます。
ファイル変更時の自動再起動 (nodemon) も有効になります。
**注意:** `npm run dev` は Datastore エミュレータへの接続を前提としています（`npm run start:emulator` を実行します）。事前にエミュレータを起動してください（後述）。

```bash
npm run dev
```

サーバーが起動すると、`http://localhost:3000` でアクセスできます。

### 3.2. テストの実行

(テストスクリプトが実装されている場合)

```bash
npm test
```

## 4. Datastore エミュレータの使用

ローカル開発では、Cloud Datastore の動作を模倣するためにエミュレータを使用します。

1.  別のターミナルを開き、エミュレータを起動します。

    ```bash
    gcloud beta emulators datastore start
    ```

2.  アプリケーションを起動します。
    ```bash
    npm run dev
    ```
    ※ `npm run dev` には `DATASTORE_EMULATOR_HOST=localhost:8081` の設定が含まれているため、手動での環境変数設定は不要です。

## 5. デバッグ

VS Code を使用している場合、`.vscode/launch.json` (もしあれば) を利用してデバッガをアタッチできます。
または、`console.log` を使用してデバッグ出力を確認してください。

API レスポンスへのデバッグログ出力 (`_debug` フィールド) は、環境変数 `ENABLE_DEBUG_LOGS` で制御されます。
デフォルトでは `true` (有効) です。無効にする場合は、環境変数 `ENABLE_DEBUG_LOGS=false` を設定して起動してください。
